%!PS-Adobe-3.0
%%Creator: groff version 1.09
%%CreationDate: Thu Feb  8 23:48:47 1996
%%DocumentNeededResources: font Times-Roman
%%+ font Times-Bold
%%+ font Times-Italic
%%DocumentSuppliedResources: procset grops 1.09 0
%%Pages: 5
%%PageOrder: Ascend
%%Orientation: Portrait
%%EndComments
%%BeginProlog
%%BeginResource: procset grops 1.09 0
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/MF{
findfont
[5 2 roll
0 3 1 roll 
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}bind def
/DA{
newpath arcn stroke
}bind def
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
/DL{
SN
moveto
SN
lineto stroke
}bind def
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
/FL{
currentgray exch setgray fill setgray
}bind def
/BL/fill load def
/LW/setlinewidth load def
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
}bind def
/PEND{
clear
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%IncludeResource: font Times-Roman
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
/Times-Roman@0 ENC0/Times-Roman RE
%%EndProlog
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(TR)79.2 48 Q 378.54(OLL\(1\) TR)-.4 F(OLL\(1\))
-.4 E/F1 9/Times-Bold@0 SF -.18(NA)79.2 84 S(ME).18 E F0
(troll \255 netw)115.2 96 Q(ork simulator / datagram forw)-.1 E(arder)
-.1 E F1(SYNOPSIS)79.2 112.8 Q/F2 10/Times-Bold@0 SF(tr)115.2 124.8 Q
(oll)-.18 E F0([)2.5 E/F3 10/Times-Italic@0 SF(options)A F0(])A F2(port)
2.5 E(#include <sys/types.h>)115.2 136.8 Q(#include <netinet/in.h>)115.2
148.8 Q(#include "tr)115.2 160.8 Q(oll.h")-.18 E F1(DESCRIPTION)79.2
177.6 Q F2 -1.2 -.74(Tr o)115.2 189.6 T(ll).74 E F0 .217
(is an application designed to simulate the v)2.717 F .217
(arious quirks and v)-.25 F(ag)-.25 E .217(aries of a netw)-.05 F .216
(ork en)-.1 F 2.716(vironment. The)-.4 F .175(troll forw)115.2 201.6 R
.175
(ards UDP datagrams between processes, possibly dropping, delaying, g)
-.1 F .176(arbling, and/or duplicating)-.05 F(those datagrams.)115.2
213.6 Q F1(COMMAND LINE ARGUMENTS)79.2 230.4 Q F2(port)115.2 242.4 Q F0
.463(The UDP port number on which the troll will listen for incoming da\
tagrams.)28.88 F .462(This ar)5.462 F .462(gument is)-.18 F(mandatory)
162.41 254.4 Q 2.5(,a)-.65 G(nd must be an inte)-2.5 E
(ger between 1024 and 65535.)-.15 E .43(The follo)115.2 271.2 R .43
(wing options o)-.25 F -.15(ve)-.15 G .43(rride v).15 F .431(arious def)
-.25 F .431(ault parameters.)-.1 F(The)5.431 E 2.931(yc)-.15 G .431
(an also be set by interacti)-2.931 F .731 -.15(ve c)-.25 H(ommands,).15
E(as described belo)115.2 283.2 Q 3.8 -.65(w. O)-.25 H
(ptions speci\214ed as).65 E F3(per)2.5 E(cent)-.37 E F0
(must be an inte)2.5 E(ger in the range from 0 through 100.)-.15 E F2
<ad62>115.2 300 Q F0(Normally)35.95 E 3.288(,t)-.65 G .788
(he troll runs in an interacti)-3.288 F 1.088 -.15(ve m)-.25 H .788
(ode, as described in the follo).15 F .788(wing section.)-.25 F(The)
5.788 E F2<ad62>3.288 E F0 1.496(option disables the interacti)162.41
312 R 1.796 -.15(ve m)-.25 H 1.497
(ode, and the troll can thus be run more con).15 F -.15(ve)-.4 G 1.497
(niently in the).15 F 2.89(background. F)162.41 324 R .39(or e)-.15 F
.39(xample, \231troll -b 26784 -s0 -x0 &\232 will start the troll in th\
e background, lis-)-.15 F
(tening on UDP port 26784 and neither delaying nor dropping datagrams.)
162.41 336 Q F2<ad66>115.2 352.8 Q F3(\214le)1.91 E F0 1.213
(The distrib)24.05 F 1.213(ution of datagram delays is to be tak)-.2 F
1.214(en from the named \214le rather than computed)-.1 F(from the)
162.41 364.8 Q F3(delay)2.5 E F0(parameter)2.5 E 5(.S)-.55 G
(ee the description of the)-5 E F2(delay \214le)2.5 E F0(interacti)2.5 E
.3 -.15(ve c)-.25 H(ommand belo).15 E -.65(w.)-.25 G F2<ad67>115.2 381.6
Q F3(per)1.25 E(cent)-.37 E F0
(The percentage of datagrams that should be g)5.64 E(arbled \(def)-.05 E
(ault is 0%\).)-.1 E F2<ad6d>115.2 398.4 Q F3(per)1.25 E(cent)-.37 E F0
(The percentage of datagrams that should be duplicated \(sent multiple \
times; def)162.41 410.4 Q(ault is 0%\).)-.1 E F2<ad72>115.2 427.2 Q F0
(Allo)37.07 E 4.266(wr)-.25 G 4.266(eordering. W)-4.266 F 1.766
(ithout this option, delays are all interpreted as relati)-.4 F -.15(ve)
-.25 G 4.265(:D).15 G 1.765(atagrams are)-4.265 F 2.563(queued \214rst-\
in-\214rst out, with delays between datagrams calculated according to t\
he delay)162.41 439.2 R .095(parameter \(see)162.41 451.2 R F3<ad73>
2.595 E F0(,).27 E F3(\255se)2.595 E F0 2.595(,a).18 G(nd)-2.595 E F3
<ad66>2.595 E F0 2.595(\). W)1.96 F .095(ith the)-.4 F F3<ad72>2.595 E
F0 .094(option, delays are absolute.)2.595 F .094(Since each datagram)
5.094 F .304
(is independently delayed, datagrams may be sent out in a dif)162.41
463.2 R .304(ferent order than the)-.25 F 2.804(ya)-.15 G(rri)-2.804 E
-.15(ve)-.25 G 2.804(d. See).15 F(further discussion under)162.41 475.2
Q F2(TECHNICAL DET)2.5 E(AILS)-.9 E F0(belo)2.5 E -.65(w.)-.25 G F2
<ad73>115.2 492 Q F3(number).36 E F2(\255se)115.2 508.8 Q F3(number).36
E F0 .512(The separation of datagrams in milliseconds \(def)162.41 520.8
R .511(ault is 100; see also)-.1 F F3<ad66>3.011 E F0 3.011(\). If)1.96
F F2(e)3.011 E F0 .511(is speci\214ed, the)3.011 F(delay is an e)162.41
532.8 Q(xponential random v)-.15 E(ariable with mean)-.25 E F3(number .)
2.5 E F0(Otherwise, it is a constant.)5 E F2<ad78>115.2 549.6 Q F3(per)
1.25 E(cent)-.37 E F0
(The percentage of datagrams that should be dropped \(def)5.64 E
(ault is 10%\).)-.1 E F1(INTERA)79.2 566.4 Q(CTIVE MODE)-.495 E F0 .422
(After being started, the troll normally runs in an interacti)115.2
578.4 R .722 -.15(ve m)-.25 H .422
(ode, and will prompt for commands with the).15 F(message)115.2 590.4 Q
(Speak to the troll:)151.2 602.4 Q 2.5(Ac)115.2 614.4 S
(ommand may be abbre)-2.5 E(viated to an)-.25 E 2.5(yu)-.15 G
(nambiguous pre\214x.)-2.5 E F2(dr)115.2 631.2 Q(op)-.18 E F3(per)2.5 E
(cent)-.37 E F0(Sets the percentage of datagrams that will be dropped \
\(i.e., will not be forw)12.21 E(arded\).)-.1 E .236
(Note that the troll can b)179.91 643.2 R(uf)-.2 E .236
(fer only a limited number of datagrams; if a datagram arri)-.25 F -.15
(ve)-.25 G 2.735(sa).15 G(nd)-2.735 E .195(no b)179.91 655.2 R(uf)-.2 E
.195(fer space is a)-.25 F -.25(va)-.2 G .195
(ilable, the datagram is dropped.).25 F(Setting)5.195 E F2(delay)2.695 E
F0(or)2.696 E F2(duplicate)2.696 E F0 .196(to a suf)2.696 F<8c2d>-.25 E
(ECE/CS 338)287.5 768 Q(1)203.3 E EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(TR)79.2 48 Q 378.54(OLL\(1\) TR)-.4 F(OLL\(1\))
-.4 E(ciently high v)179.91 84 Q
(alue may result datagrams being dropped e)-.25 E -.15(ve)-.25 G 2.5(ni)
.15 G 2.5(ft)-2.5 G(he)-2.5 E/F1 10/Times-Bold@0 SF(dr)2.5 E(op)-.18 E
F0(parameter is zero.)2.5 E F1(delay)115.2 100.8 Q/F2 10/Times-Italic@0
SF(milliseconds)2.5 E F1(delay exponential)115.2 117.6 Q F2(mean)2.5 E
F1(delay \214le)115.2 134.4 Q F2(\214lename)2.5 E F0 .828
(These commands control the)179.91 146.4 R F1(delay)3.328 E F0(distrib)
3.328 E 3.328(ution. Depending)-.2 F .827(on the setting of the)3.327 F
F1 -.18(re)3.327 G(order).18 E F0 1.122(option, the)179.91 158.4 R F1
(delay)3.622 E F0 1.123
(parameter controls the delay of datagrams or separation between them.)
3.622 F 1.212(The \214rst form sets)179.91 170.4 R F1(delay)3.712 E F0
1.212(to a speci\214c v)3.712 F 3.712(alue. The)-.25 F 1.212
(second sets it to an e)3.712 F 1.211(xponentially dis-)-.15 F(trib)
179.91 182.4 Q .215(uted random v)-.2 F .215
(ariable with the indicated mean.)-.25 F .215(\(Other distrib)5.215 F
.215(utions may be pro)-.2 F .215(vided by)-.15 F .557
(future releases of the troll\).)179.91 194.4 R .556
(The third form sets it to a random v)5.556 F .556
(ariable with a distrib)-.25 F(ution)-.2 E .703
(indicated by the histogram contained in the named \214le.)179.91 206.4
R .704(The third form tak)5.704 F .704(es the distrib)-.1 F(u-)-.2 E .38
(tion from a \214le.)179.91 218.4 R .38
(The \214rst line of the \214le should contain an inte)5.38 F .38
(ger indicating the precision,)-.15 F 1.685(in milliseconds.)179.91
230.4 R 1.686(The remainder of the \214le should ha)6.685 F 1.986 -.15
(ve h)-.2 H -2.25 -.2(av e).15 H 1.686(one line for each possible)4.386
F .32(delay v)179.91 242.4 R .32
(alue \(in multiples of the precision\).)-.25 F .319
(The length of each line \(not including the ne)5.319 F(w-)-.25 E 1.865
(line character at its end\) controls the relati)179.91 254.4 R 2.165
-.15(ve f)-.25 H(requenc).15 E 4.365(yo)-.15 G 4.365(fc)-4.365 G 1.865
(orresponding delays.)-4.365 F(\(The)6.865 E
(actual contents of the lines are ignored\).)179.91 266.4 Q -.15(Fo)5 G
2.5(re).15 G(xample, if \214le contains)-2.65 E(100)208.71 282 Q(<tw)
208.71 294 Q 2.5(oe)-.1 G(mpty lines>)-2.5 E(xx)208.71 306 Q(xxxxxx)
208.71 318 Q(xxx)208.71 330 Q(x)208.71 342 Q(x)208.71 354 Q 2.11(then 2\
/13 of the datagrams will be delayed 200ms, 6/13 will be delayed 300ms,\
 3/13)179.91 369.6 R .599(400ms, 1/13 500ms, 1/13 600ms, and no datagra\
ms will be delayed less than 200 or more)179.91 381.6 R .302
(than 600 milliseconds.)179.91 393.6 R .302(As a special case, a \214le\
 with only one non-empty line after the \214rst)5.302 F
(will generate a deterministic distrib)179.91 405.6 Q
(ution \(all datagrams delayed the same amount of time\).)-.2 E F2 -.92
(Wa)179.91 417.6 S(rning:).92 E F0 .487
(Although delays are speci\214ed in milliseconds, the Unix timing f)
2.986 F .487(acilities are usu-)-.1 F
(ally less precise, so delays may actually be longer than speci\214ed.)
179.91 429.6 Q F1(garble)115.2 446.4 Q F2(per)2.5 E(cent)-.37 E F0 1.118
(Sets the percent of forw)5.37 F 1.117(arded datagrams that will be g)
-.1 F 1.117(arbled \(i.e., ha)-.05 F 1.417 -.15(ve o)-.2 H 1.117
(ne or more bits).15 F(changed\).)179.91 458.4 Q F1(duplicate)115.2
475.2 Q F2(per)2.5 E(cent)-.37 E F0 .274(Sets the percent of forw)179.91
487.2 R .275
(arded datagrams that will be duplicated \(i.e., transmitted more than)
-.1 F .756(once\); of those,)179.91 499.2 R F2(per)3.256 E(cent)-.37 E
F0 .756(will be duplicated ag)3.256 F .756(ain, etc.)-.05 F .755
(Each duplicate of a particular data-)5.756 F
(gram is independently delayed and g)179.91 511.2 Q(arbled.)-.05 E F1
(sour)115.2 528 Q(ce)-.18 E F2(\214lename)2.5 E F0(Reads \231interacti)
179.91 540 Q -.15(ve)-.25 G 2.5<9a63>.15 G(ommands from.)-2.5 E F2
(\214lename)5 E(.)-.15 E F0(The remaining commands do not tak)115.2
556.8 Q 2.5(ea)-.1 G .3 -.15(ny a)-2.5 H -.18(rg).15 G(ument.).18 E F1
-.18(re)115.2 573.6 S(order).18 E F0 -.8(To)32.13 G 1.645(ggles the).8 F
F1 -.18(re)4.145 G(order).18 E F0 1.645(option \(initially)4.145 F F2
(of)4.145 E(f)-.18 E F0 1.645(unless set by the)4.145 F F1<ad72>4.146 E
F0 1.646(command-line option\).)4.146 F(If)6.646 E F1 -.18(re)179.91
585.6 S(order).18 E F0 .51(is of)3.01 F .51(f, the)-.25 F F1(delay)3.01
E F0(distrib)3.009 E .509(ution is used to compute the delay)-.2 F F2
(between)3.009 E F0 .509(datagrams sent)3.009 F 3.797(out. If)179.91
597.6 R F1 -.18(re)3.797 G(order).18 E F0 1.297(is on, the)3.797 F F1
(delay)3.797 E F0(distrib)3.797 E 1.298(ution is used to compute the)-.2
F F2(total)3.798 E F0 1.298(delay for each)3.798 F .28
(datagram \(or duplicate\).)179.91 609.6 R .28(If the)5.28 F F1 -.18(re)
2.78 G(order).18 E F0 .28(option is on and)2.78 F F1(delay)2.78 E F0 .28
(is not a constant, datagrams)2.78 F(may not be forw)179.91 621.6 Q
(arded in the same order the)-.1 E 2.5(yw)-.15 G(ere recei)-2.5 E -.15
(ve)-.25 G(d.).15 E F1(parameters)115.2 638.4 Q F0(Prints the current v)
15.84 E(alues of the reliability parameters.)-.25 E F1(statistics)115.2
655.2 Q F0 1.379
(Prints statistics about the number of datagrams dropped, g)28.05 F
1.379(arbled, duplicated, etc.)-.05 F(These)6.38 E
(statistics are also printed on termination.)179.91 667.2 Q F1
(clearstats)115.2 684 Q F0
(Clears all statistics to zero \(the startup v)24.17 E(alue\).)-.25 E F1
(backgr)115.2 700.8 Q(ound)-.18 E F0(\(Alias)13.21 E F1(zap)2.914 E F0
2.913(\). T)B .413(ells the troll to stop accepting interacti)-.7 F .713
-.15(ve c)-.25 H 2.913(ommands. This).15 F .413(command is use-)2.913 F
.055(ful for putting the troll into the background.)179.91 712.8 R -1.1
(Yo)5.055 G 2.555(uc)1.1 G .056
(an then type `^Z' and `bg' to actually put)-2.555 F
(the troll in the background.)179.91 724.8 Q(\(See also)5 E F1<ad62>2.5
E F0(\).)A(ECE/CS 338)287.5 768 Q(2)203.3 E EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(TR)79.2 48 Q 378.54(OLL\(1\) TR)-.4 F(OLL\(1\))
-.4 E/F1 10/Times-Bold@0 SF(quit)115.2 84 Q F0 .118
(Causes the troll to print statistics and terminate.)47.48 F .118
(The same ef)5.118 F .118(fect is produced by an interac-)-.25 F(ti)
179.91 96 Q .3 -.15(ve \231)-.25 H(command\232 of control-D or by a k)
.15 E -.15(ey)-.1 G(board interrupt \(or kill -INT\).).15 E F1(trace)
115.2 112.8 Q F0 -.8(To)43.06 G .376(ggles the).8 F F1(trace)2.876 E F0
2.876(option. When)2.876 F .376(tracing is enabled, the)2.876 F F1(tr)
2.877 E(oll)-.18 E F0 .377(prints a message starting with)2.877 F .77
(`<' on each datagram arri)179.91 124.8 R -.25(va)-.25 G .769
(l, and a message starting with `>' on each datagram transmis-).25 F
(sion.)179.91 136.8 Q/F2 9/Times-Bold@0 SF(PR)79.2 153.6 Q
(OGRAMMING INTERF)-.27 E -.495(AC)-.81 G(E).495 E F0 1.178
(The data contained in e)115.2 165.6 R -.15(ve)-.25 G 1.178
(ry UDP datagram sent to the troll must be).15 F 1.178(gin with a)-.15 F
/F3 10/Times-Italic@0 SF(soc)3.679 E(kaddr_in)-.2 E F0 1.179
(structure, as)3.679 F(de\214ned in <netinet/in.h>:)115.2 177.6 Q
(struct sockaddr_in {)144 193.2 Q 13.5(short sin_f)180 205.2 R(amily;)
-.1 E 3.5(u_short sin_port;)180 217.2 R 11.28(struct in_addr)180 229.2 R
(sin_addr;)2.5 E 16.29(char sin_zero[8];)180 241.2 R(};)144 253.2 Q(The)
115.2 268.8 Q F1(tr)3.269 E(oll)-.18 E F0(forw)3.269 E .768
(ards the datagram to the sock)-.1 F .768(et addressed by this \214eld.)
-.1 F .768(Before forw)5.768 F .768(arding the datagram, it)-.1 F -.15
(ove)115.2 280.8 S(rwrites this \214eld with the address of the sock).15
E(et from which it came.)-.1 E F3(Note:)115.2 297.6 Q F0 1.365
(All \214elds must be in netw)3.865 F 1.365(ork byte order)-.1 F 6.365
(.T)-.55 G 1.365(his this con)-6.365 F -.15(ve)-.4 G 1.365(ntion dif).15
F 1.366(fers from system calls \(such as)-.25 F F3(sendto\(2\))115.2
309.6 Q F0(and)2.5 E F3 -.37(re)2.5 G(cvfr).37 E(om\(2\))-.45 E F0 2.5
(\)w).06 G(hich e)-2.5 E(xpect the sin_f)-.15 E
(amily \214eld to be in host byte order)-.1 E(.)-.55 E -.15(Fo)115.2
326.4 S 2.5(re).15 G
(xample, if a program sends datagrams using code similar to)-2.65 E
(struct sockaddr_in dest;)144 342 Q(char b)144 354 Q(uf)-.2 E(fer[B)-.25
E(UFFER_SIZE];)-.1 E(dest.sin_f)144 378 Q(amily = AF_INET)-.1 E(;)-.55 E
(dest.sin_addr = /* Internet address of remote machine */;)144 390 Q
(dest.sin_port = htons\(POR)144 402 Q(T\);)-.6 E(.)180 414 Q(.)180 426 Q
(.)180 438 Q(/* \214ll b)144 450 Q(uf)-.2 E(fer with data */)-.25 E
(result = sendto\(sock)144 474 Q(et, b)-.1 E(uf)-.2 E(fer)-.25 E 2.5(,s)
-.4 G(izeof b)-2.5 E(uf)-.2 E(fer)-.25 E 2.5(,0)-.4 G 2.5(,\()-2.5 G
(struct sockaddr *\)dest, sizeof dest\);)-2.5 E
(it can be transformed to use the)115.2 489.6 Q F1(tr)2.5 E(oll)-.18 E
F0(as follo)2.5 E(ws)-.25 E(struct sockaddr_in dest, troll;)144 505.2 Q
(struct {)144 517.2 Q(struct sockaddr_in header;)180 529.2 Q
(char body[B)180 541.2 Q(UFFER_SIZE];)-.1 E 2.5(}m)144 553.2 S(essage;)
-2.5 E(message.header)144 577.2 Q(.sin_f)-.55 E
(amily = htons\(AF_INET\);)-.1 E(message.header)144 589.2 Q
(.sin_addr = /* Internet address of remote machine */;)-.55 E
(message.header)144 601.2 Q(.sin_port = htons\(POR)-.55 E(T\);)-.6 E
(troll.sin_f)144 625.2 Q(amily = AF_INET)-.1 E(;)-.55 E
(troll.sin_addr = /* Internet address of machine running the troll */;)
144 637.2 Q(troll.sin_port = htons\(TR)144 649.2 Q(OLL_POR)-.4 E(T\);)
-.6 E(.)180 661.2 Q(.)180 673.2 Q(.)180 685.2 Q(/* \214ll b)144 697.2 Q
(uf)-.2 E(fer with data */)-.25 E(result = sendto\(sock)144 721.2 Q(et,\
 \(char *\)&message, sizeof message, 0, \(struct sockaddr *\)troll, siz\
eof troll\);)-.1 E(ECE/CS 338)287.5 768 Q(3)203.3 E EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(TR)79.2 48 Q 378.54(OLL\(1\) TR)-.4 F(OLL\(1\))
-.4 E .234(When the datagram arri)115.2 84 R -.15(ve)-.25 G .234
(s, the header is in the correct format for a reply).15 F 5.233(.T)-.65
G .233(hus a simple \231echo serv)-5.233 F .233(er\232 has)-.15 F
(the outline)115.2 96 Q(for\(;;\) {)144 111.6 Q
(struct sockaddr_in trolladdr;)180 123.6 Q(int len = sizeof trolladdr;)
180 135.6 Q(NetMessage message;)180 147.6 Q
(/* read in one message from the troll */)180 171.6 Q 2.5(n=r)180 183.6
S(ecvfrom\(sock, \(char *\)&message, sizeof message, 0,)-2.5 E
(\(struct sockaddr *\)&trolladdr)252 195.6 Q 2.5(,&)-.4 G(len\);)-2.5 E
(if \(n<0\) {)180 207.6 Q(perror\("fromtroll recvfrom"\);)216 219.6 Q
-.15(ex)216 231.6 S(it\(1\);).15 E(})180 243.6 Q
(printf\("troll [%s,%d]",)180 255.6 Q(inet_ntoa\(trolladdr)216 267.6 Q
(.sin_addr\), ntohs\(trolladdr)-.55 E(.sin_port\)\);)-.55 E
(printf\("source [%s,%d]0,)180 279.6 Q(inet_ntoa\(message.msg_header)216
291.6 Q(.sin_addr\),)-.55 E(ntohs\(message.msg_header)216 303.6 Q
(.sin_port\)\);)-.55 E 2.5(n=s)180 315.6 S
(endto\(sock, \(char *\)&message, sizeof message, 0,)-2.5 E
(\(struct sockaddr *\)&trolladdr)324 327.6 Q 2.5(,l)-.4 G(en\);)-2.5 E
(if \(n!=sizeof message\) {)180 339.6 Q(perror\("fromtroll sendto"\);)
216 351.6 Q -.15(ex)216 363.6 S(it\(1\);).15 E(})180 375.6 Q(})144 387.6
Q -.35(Tr)115.2 403.2 S
(oll.c, as well as test programs totroll.c and fromtroll.c are a).35 E
-.25(va)-.2 G(ilable in the course home page.).25 E/F1 9/Times-Bold@0 SF
(TECHNICAL DET)79.2 420 Q(AILS)-.81 E F0(Whene)115.2 432 Q -.15(ve)-.25
G 3.056(rad).15 G .556(atagram arri)-3.056 F -.15(ve)-.25 G .556
(s, the troll e).15 F .556
(xamines the header to see whether the sockaddr there meets mini-)-.15 F
.596(mal sanity checks \(it requires that ntohs\(header)115.2 444 R
(.sin_f)-.55 E .596(amily\) is AF_INET and that htohs\(header)-.1 F .595
(.sin_port\) is)-.55 F .512
(in the range 1024..65535; it does not check whether header)115.2 456 R
.512(.sin_addr is reasonable\).)-.55 F .512(If not, it increments a)
5.512 F 1.026(counter and drops the datagram.)115.2 468 R 1.025
(Otherwise, it records the destination address from the header and o)
6.026 F -.15(ve)-.15 G -.2(r-).15 G(writes it with the sock)115.2 480 Q
(et address of the sender)-.1 E(.)-.55 E(Ne)115.2 496.8 Q .104
(xt, the troll \215ips a coin, and with probability)-.15 F/F2 10
/Times-Bold@0 SF(dr)2.604 E(op)-.18 E F0 .104(it thro)2.604 F .104(ws a)
-.25 F -.1(wa)-.15 G 2.604(yt).1 G .104
(he datagram \(incrementing a counter\).)-2.604 F .65
(Otherwise, it \215ips another coin and with probability)115.2 508.8 R
F2(garble)3.149 E F0 -.05(ga)3.149 G .649(rbles the datagram.).05 F .649
(The g)5.649 F .649(arbling algorithm)-.05 F .972
(chooses 5 to 10 bytes of the datagram and xor')115.2 520.8 R 3.472(st)
-.55 G .972(hem with a random pattern.)-3.472 F .972
(The bytes are chosen ran-)5.972 F(domly)115.2 532.8 Q 3.882(,e)-.65 G
1.381(xcept that one g)-4.032 F 1.381(arbled byte is guaranteed to be a\
mong the \214rst 10 bytes of the datagram.)-.05 F(The)6.381 E
(return address is not g)115.2 544.8 Q(arbled.)-.05 E(Ne)115.2 561.6 Q
.593(xt, the troll calculates when to transmit the datagram and schedul\
es a timer e)-.15 F -.15(ve)-.25 G .593(nt to send it.).15 F 3.093(Ar)
5.593 G(andom)-3.093 E -.25(va)115.2 573.6 S .101
(lue is computed according to the current).25 F F2(delay)2.601 E F0
2.601(settings. If)2.601 F(the)2.601 E F2 -.18(re)2.6 G(order).18 E F0
.1(parameter is)2.6 F/F3 10/Times-Italic@0 SF(on)2.6 E F0 2.6(,t).24 G
.1(he dispatch time)-2.6 F .063(is calculated by adding the random v)
115.2 585.6 R .063(alue to the to the current time.)-.25 F .063
(Otherwise, it is calculated to adding the)5.063 F .985(random v)115.2
597.6 R .985(alue to the latest dispatch time an)-.25 F 3.484(yd)-.15 G
.984(atagram currently queued for deli)-3.484 F -.15(ve)-.25 G(ry).15 E
5.984(.T)-.65 G .984(he timer queue is)-5.984 F .308
(maintained such that requests to send tw)115.2 609.6 R 2.809(oo)-.1 G
2.809(rm)-2.809 G .309
(ore datagrams at the same time are satis\214ed \214rst-come-\214rst-)
-2.809 F(serv)115.2 621.6 Q(ed.)-.15 E .087
(After the troll queues a datagram for deli)115.2 638.4 R -.15(ve)-.25 G
(ry).15 E 2.586(,i)-.65 G 2.586<748d>-2.586 G .086
(ips a coin and with probability)-2.586 F F2(duplicate)2.586 E F0(mak)
2.586 E .086(es a cop)-.1 F 2.586(yo)-.1 G(f)-2.586 E 2.128
(the datagram.)115.2 650.4 R 2.128(The cop)7.128 F 4.628(yi)-.1 G 4.628
(st)-4.628 G 2.128(reated as an independent arri)-4.628 F -.25(va)-.25 G
4.628(la).25 G 2.128(nd duplicated, delayed, g)-4.628 F 2.128
(arbled, etc. as)-.05 F(described abo)115.2 662.4 Q -.15(ve)-.15 G(.).15
E F1(SURGEON GENERAL)79.2 679.2 Q('S W)-.99 E(ARNING)-1.08 E F0 .312
(Since UDP does no \215o)115.2 691.2 R 2.812(wc)-.25 G .312
(ontrol, datagrams will be dropped if you send them to the troll too f)
-2.812 F .311(ast, or if you)-.1 F(don')115.2 703.2 Q 2.8(tr)-.18 G
(ecei)-2.8 E .6 -.15(ve t)-.25 H .3(hem f).15 F .3
(ast enough from the troll.)-.1 F .301(Thus datagrams may be dropped e)
5.301 F -.15(ve)-.25 G 2.801(ni).15 G 2.801(ft)-2.801 G .301
(he troll parameters)-2.801 F
(are set for `perfect reliability' \(all probabilities 0\).)115.2 715.2
Q(ECE/CS 338)287.5 768 Q(4)203.3 E EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 10/Times-Roman@0 SF(TR)79.2 48 Q 378.54(OLL\(1\) TR)-.4 F(OLL\(1\))
-.4 E/F1 9/Times-Bold@0 SF -.09(BU)79.2 84 S(GS).09 E F0 1.171
(There should be more con)115.2 96 R -.15(ve)-.4 G 1.171(nient w).15 F
1.171(ays to specify other distrib)-.1 F 1.17
(utions of delay \(such as normal or h)-.2 F(yper)-.05 E(-)-.2 E -.15
(ex)115.2 108 S .913(ponential\) and to specify distrib).15 F .913
(utions for other random v)-.2 F 3.413(ariables. There)-.25 F .914
(should be some w)3.413 F .914(ay to mak)-.1 F(e)-.1 E .812
(the delay depend in complicated w)115.2 120 R .812
(ays on the number of datagrams currently queued, to simulate conges-)
-.1 F(tion in the netw)115.2 132 Q(ork.)-.1 E F1 -.45(AU)79.2 148.8 S
(THORS).45 E F0 1.252(The troll w)115.2 160.8 R 1.252
(as originally written by Mitchell T)-.1 F 3.752(asman. It)-.8 F 1.252
(has been e)3.752 F(xtensi)-.15 E -.15(ve)-.25 G 1.252
(ly modi\214ed and enhanced by).15 F(Marvin Solomon.)115.2 172.8 Q
(ECE/CS 338)287.5 768 Q(5)203.3 E EP
%%Trailer
end
%%EOF
